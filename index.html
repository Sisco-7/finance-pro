<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Finance Pro</title><!-- SDKs only load in Canva environment -->
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #1e40af;
      --primary-dark: #1e3a8a;
      --primary-light: #3b82f6;
      --secondary: #f59e0b;
      --secondary-dark: #d97706;
      --secondary-light: #fbbf24;
      --danger: #ef4444;
      --warning: #f59e0b;
      --success: #10b981;
      --bg-primary: #f8fafc;
      --bg-secondary: #ffffff;
      --bg-tertiary: #f1f5f9;
      --surface: rgba(0, 0, 0, 0.02);
      --surface-hover: rgba(0, 0, 0, 0.05);
      --text-primary: #0f172a;
      --text-secondary: #475569;
      --text-tertiary: #64748b;
      --border: rgba(0, 0, 0, 0.1);
      --shadow: rgba(0, 0, 0, 0.1);
      --gradient-primary: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
      --gradient-secondary: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
      --gradient-mixed: linear-gradient(135deg, #1e40af 0%, #f59e0b 100%);
    }

    body.dark-mode {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --primary-light: #60a5fa;
      --secondary: #fbbf24;
      --secondary-dark: #f59e0b;
      --secondary-light: #fcd34d;
      --danger: #ef4444;
      --warning: #f59e0b;
      --success: #10b981;
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-tertiary: #334155;
      --surface: rgba(255, 255, 255, 0.08);
      --surface-hover: rgba(255, 255, 255, 0.12);
      --text-primary: #f8fafc;
      --text-secondary: #e2e8f0;
      --text-tertiary: #cbd5e1;
      --border: rgba(255, 255, 255, 0.15);
      --shadow: rgba(0, 0, 0, 0.5);
    }

    html, body {
      height: 100%;
      width: 100%;
      overflow: hidden;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      transition: background 0.3s, color 0.3s;
    }

    /* Splash Screen */
    .splash-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--gradient-mixed);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      animation: fadeOut 0.5s ease 2.5s forwards;
    }

    @keyframes fadeOut {
      to {
        opacity: 0;
        visibility: hidden;
      }
    }

    .splash-logo {
      font-size: 64px;
      font-weight: 900;
      color: white;
      margin-bottom: 16px;
      text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      animation: slideDown 0.8s ease;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-50px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .splash-tagline {
      font-size: 20px;
      color: rgba(255, 255, 255, 0.9);
      margin-bottom: 48px;
      animation: fadeIn 0.8s ease 0.3s both;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .splash-loader {
      width: 60px;
      height: 60px;
      position: relative;
      animation: fadeIn 0.8s ease 0.6s both;
    }

    .splash-loader::before,
    .splash-loader::after {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      border: 4px solid transparent;
      border-top-color: white;
      animation: spin 1.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
    }

    .splash-loader::after {
      border-top-color: var(--secondary-light);
      animation-delay: 0.3s;
      animation-duration: 1.2s;
    }

    @keyframes spin {
      0% { transform: rotate(0deg) scale(1); }
      50% { transform: rotate(180deg) scale(1.1); }
      100% { transform: rotate(360deg) scale(1); }
    }

    .app-wrapper {
      display: flex;
      height: 100%;
      width: 100%;
      opacity: 0;
      animation: fadeIn 0.5s ease 3s forwards;
    }

    /* Sidebar */
    .sidebar {
      width: 280px;
      background: var(--bg-secondary);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      transition: transform 0.3s ease;
      z-index: 100;
    }

    .sidebar-header {
      padding: 24px;
      border-bottom: 1px solid var(--border);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background: var(--gradient-mixed);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .nav-menu {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      margin-bottom: 4px;
      border-radius: 10px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s;
      font-size: 15px;
      font-weight: 500;
      border: none;
      background: transparent;
      width: 100%;
      text-align: left;
    }

    .nav-item:hover {
      background: var(--surface-hover);
      color: var(--text-primary);
    }

    .nav-item.active {
      background: var(--gradient-mixed);
      color: white;
    }

    .nav-item svg {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
    }

    .sidebar-footer {
      padding: 16px;
      border-top: 1px solid var(--border);
    }

    /* Main Content */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .top-bar {
      height: 72px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 32px;
      gap: 16px;
    }

    .search-bar {
      flex: 1;
      max-width: 500px;
      position: relative;
    }

    .search-bar input {
      width: 100%;
      padding: 10px 16px 10px 44px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 14px;
      transition: all 0.2s;
    }

    .search-bar input:focus {
      outline: none;
      border-color: var(--primary);
      background: var(--surface-hover);
    }

    .search-icon {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      width: 18px;
      height: 18px;
      color: var(--text-tertiary);
    }

    .top-bar-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .icon-btn {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      background: var(--surface);
      border: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      color: var(--text-secondary);
    }

    .icon-btn:hover {
      background: var(--surface-hover);
      color: var(--text-primary);
      transform: translateY(-1px);
    }

    .icon-btn svg {
      width: 20px;
      height: 20px;
    }

    .currency-selector {
      padding: 8px 16px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .currency-selector:hover {
      background: var(--surface-hover);
    }

    /* Content Area */
    .content-area {
      flex: 1;
      overflow-y: auto;
      padding: 32px;
    }

    .page-header {
      margin-bottom: 32px;
    }

    .page-title {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--text-primary);
    }

    .page-subtitle {
      font-size: 16px;
      color: var(--text-secondary);
    }

    /* Dashboard Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gradient-mixed);
    }

    .stat-card.income::before {
      background: var(--gradient-secondary);
    }

    .stat-card.expense::before {
      background: linear-gradient(90deg, var(--danger), #f87171);
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px var(--shadow);
    }

    .stat-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
    }

    .stat-label {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .stat-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--surface);
    }

    .stat-icon svg {
      width: 20px;
      height: 20px;
    }

    .stat-value {
      font-size: 36px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .stat-change {
      font-size: 13px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .stat-change.positive {
      color: var(--success);
    }

    .stat-change.negative {
      color: var(--danger);
    }

    /* Cards */
    .card {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      flex-wrap: wrap;
      gap: 16px;
    }

    .card-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
    }

    /* Buttons */
    .btn {
      padding: 12px 24px;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-family: inherit;
    }

    .btn-primary {
      background: var(--gradient-mixed);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(30, 64, 175, 0.3);
    }

    .btn-secondary {
      background: var(--surface);
      color: var(--text-primary);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--surface-hover);
    }

    .btn-danger {
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger);
      border: 1px solid rgba(239, 68, 68, 0.2);
      padding: 8px 16px;
      font-size: 13px;
    }

    .btn-danger:hover {
      background: rgba(239, 68, 68, 0.2);
    }

    .btn-success {
      background: var(--success);
      color: white;
      padding: 8px 16px;
      font-size: 13px;
    }

    .btn-success:hover {
      background: #059669;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
    }

    .btn svg {
      width: 18px;
      height: 18px;
    }

    /* Filters */
    .filters {
      display: flex;
      gap: 12px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }

    .filter-chip {
      padding: 8px 16px;
      border-radius: 20px;
      background: var(--surface);
      border: 1px solid var(--border);
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .filter-chip:hover {
      background: var(--surface-hover);
      color: var(--text-primary);
    }

    .filter-chip.active {
      background: var(--gradient-mixed);
      border-color: var(--primary);
      color: white;
    }

    /* Transaction List */
    .transaction-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .transaction-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      transition: all 0.2s;
    }

    .transaction-item:hover {
      background: var(--surface-hover);
      transform: translateX(4px);
    }

    .transaction-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .transaction-icon.income {
      background: rgba(16, 185, 129, 0.1);
      color: var(--success);
    }

    .transaction-icon.expense {
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger);
    }

    .transaction-icon svg {
      width: 24px;
      height: 24px;
    }

    .transaction-details {
      flex: 1;
      min-width: 0;
    }

    .transaction-category {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .transaction-description {
      font-size: 14px;
      color: var(--text-secondary);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      margin-bottom: 4px;
    }

    .transaction-meta {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .transaction-date {
      font-size: 12px;
      color: var(--text-tertiary);
    }

    .transaction-tag {
      font-size: 11px;
      padding: 2px 8px;
      background: var(--primary);
      color: white;
      border-radius: 4px;
      font-weight: 600;
    }

    .transaction-recurring {
      font-size: 11px;
      padding: 2px 8px;
      background: var(--warning);
      color: white;
      border-radius: 4px;
      font-weight: 600;
    }

    .transaction-amount {
      font-size: 20px;
      font-weight: 700;
      white-space: nowrap;
      margin-right: 16px;
    }

    .transaction-amount.income {
      color: var(--success);
    }

    .transaction-amount.expense {
      color: var(--danger);
    }

    .transaction-actions {
      display: flex;
      gap: 8px;
    }

    /* Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn 0.2s;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 40px;
      max-width: 700px;
      width: 100%;
      max-height: 90%;
      overflow-y: auto;
      box-shadow: 0 20px 40px var(--shadow);
      animation: slideUp 0.3s;
    }

    @keyframes slideUp {
      from {
        transform: translateY(20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
    }

    .modal-title {
      font-size: 28px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .close-btn {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      background: var(--surface);
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: var(--text-secondary);
      transition: all 0.2s;
    }

    .close-btn:hover {
      background: var(--surface-hover);
      color: var(--text-primary);
    }

    /* Form */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-bottom: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    label {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    input, select, textarea {
      padding: 16px 20px;
      background: var(--bg-primary);
      border: 2px solid var(--border);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 16px;
      font-family: inherit;
      transition: all 0.2s;
      width: 100%;
      min-height: 52px;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
    }

    input:hover, select:hover, textarea:hover {
      border-color: var(--primary-light);
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      background: var(--bg-secondary);
      box-shadow: 0 0 0 4px rgba(30, 64, 175, 0.1);
    }

    textarea {
      resize: vertical;
      min-height: 120px;
      line-height: 1.6;
    }

    select {
      cursor: pointer;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 12 12'%3E%3Cpath fill='%23475569' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 16px center;
      padding-right: 50px;
    }
    
    body.dark-mode select {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 12 12'%3E%3Cpath fill='%23cbd5e1' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 12px;
      padding: 16px;
      background: var(--surface);
      border-radius: 12px;
      border: 2px solid var(--border);
    }

    .checkbox-group input[type="checkbox"] {
      width: 20px;
      height: 20px;
      min-height: auto;
      cursor: pointer;
      accent-color: var(--primary);
    }

    .checkbox-group label {
      margin: 0;
      cursor: pointer;
      font-size: 15px;
      font-weight: 500;
      color: var(--text-primary);
      text-transform: none;
      letter-spacing: normal;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
    }

    .empty-state-icon {
      width: 80px;
      height: 80px;
      margin: 0 auto 20px;
      background: var(--surface);
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-tertiary);
    }

    .empty-state-icon svg {
      width: 40px;
      height: 40px;
    }

    .empty-state-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .empty-state-text {
      font-size: 15px;
      color: var(--text-secondary);
    }

    /* Charts */
    .chart-container {
      margin-top: 24px;
    }

    .chart-bar {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 16px;
    }

    .chart-label {
      width: 140px;
      font-size: 14px;
      font-weight: 600;
      color: var(--text-secondary);
      flex-shrink: 0;
    }

    .chart-bar-bg {
      flex: 1;
      height: 32px;
      background: var(--surface);
      border-radius: 8px;
      overflow: hidden;
      position: relative;
    }

    .chart-bar-fill {
      height: 100%;
      background: var(--gradient-mixed);
      border-radius: 8px;
      transition: width 0.5s ease;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 12px;
    }

    .chart-bar-value {
      font-size: 13px;
      font-weight: 700;
      color: white;
    }

    /* Progress Bar */
    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--surface);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 8px;
    }

    .progress-fill {
      height: 100%;
      background: var(--gradient-mixed);
      border-radius: 4px;
      transition: width 0.5s ease;
    }

    .progress-fill.warning {
      background: var(--gradient-secondary);
    }

    .progress-fill.danger {
      background: linear-gradient(90deg, var(--danger), #f87171);
    }

    /* Budget Card */
    .budget-item {
      padding: 20px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      margin-bottom: 16px;
    }

    .budget-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .budget-category {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .budget-amounts {
      display: flex;
      gap: 8px;
      align-items: center;
      font-size: 14px;
    }

    .budget-spent {
      color: var(--text-primary);
      font-weight: 600;
    }

    .budget-total {
      color: var(--text-tertiary);
    }

    /* Goal Card */
    .goal-card {
      padding: 20px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      margin-bottom: 16px;
    }

    .goal-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .goal-name {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .goal-target {
      font-size: 14px;
      color: var(--text-secondary);
    }

    .goal-progress {
      font-size: 24px;
      font-weight: 700;
      color: var(--primary);
    }

    /* Info Section */
    .info-section {
      margin-bottom: 24px;
    }

    .info-section h3 {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 12px;
    }

    .info-section p {
      font-size: 15px;
      color: var(--text-secondary);
      line-height: 1.6;
      margin-bottom: 12px;
    }

    .info-section ul {
      list-style: none;
      padding: 0;
    }

    .info-section li {
      font-size: 15px;
      color: var(--text-secondary);
      line-height: 1.8;
      padding-left: 24px;
      position: relative;
      margin-bottom: 8px;
    }

    .info-section li::before {
      content: '✓';
      position: absolute;
      left: 0;
      color: var(--primary);
      font-weight: 700;
    }

    .developer-link {
      color: var(--primary);
      text-decoration: none;
      font-weight: 600;
      transition: all 0.2s;
    }

    .developer-link:hover {
      color: var(--primary-light);
      text-decoration: underline;
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      color: var(--text-primary);
      padding: 16px 24px;
      border-radius: 12px;
      box-shadow: 0 10px 20px var(--shadow);
      display: none;
      align-items: center;
      gap: 12px;
      z-index: 2000;
      animation: slideIn 0.3s;
      max-width: 400px;
    }

    .toast.show {
      display: flex;
    }

    .toast.success {
      border-left: 4px solid var(--success);
    }

    .toast.error {
      border-left: 4px solid var(--danger);
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .toast-icon {
      width: 24px;
      height: 24px;
      flex-shrink: 0;
    }

    .toast-message {
      flex: 1;
      font-size: 14px;
      font-weight: 500;
    }

    /* FAB */
    .fab {
      position: fixed;
      bottom: 32px;
      right: 32px;
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: var(--gradient-mixed);
      border: none;
      box-shadow: 0 8px 24px rgba(30, 64, 175, 0.4);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
      z-index: 50;
    }

    .fab:hover {
      transform: scale(1.1) rotate(90deg);
      box-shadow: 0 12px 32px rgba(30, 64, 175, 0.5);
    }

    .fab svg {
      width: 28px;
      height: 28px;
      color: white;
    }

    /* Time Period Selector */
    .period-selector {
      display: flex;
      gap: 8px;
      padding: 4px;
      background: var(--surface);
      border-radius: 10px;
      border: 1px solid var(--border);
    }

    .period-btn {
      padding: 8px 16px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .period-btn:hover {
      color: var(--text-primary);
    }

    .period-btn.active {
      background: var(--gradient-mixed);
      color: white;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        bottom: 0;
        transform: translateX(-100%);
        box-shadow: 4px 0 20px var(--shadow);
        z-index: 200;
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .sidebar.open::before {
        content: '';
        position: fixed;
        top: 0;
        left: 280px;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: -1;
      }

      .content-area {
        padding: 20px 16px;
      }

      .top-bar {
        padding: 0 16px;
        height: 64px;
      }

      .stats-grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }

      .fab {
        bottom: 20px;
        right: 20px;
        width: 56px;
        height: 56px;
      }

      .page-title {
        font-size: 28px;
      }

      .page-subtitle {
        font-size: 15px;
      }

      .card {
        padding: 20px;
        margin-bottom: 20px;
      }

      .card-title {
        font-size: 18px;
      }

      .stat-card {
        padding: 20px;
      }

      .stat-value {
        font-size: 32px;
      }
    }

    @media (max-width: 640px) {
      .page-title {
        font-size: 24px;
      }

      .page-subtitle {
        font-size: 14px;
      }

      .stat-value {
        font-size: 28px;
      }

      .stat-label {
        font-size: 12px;
      }

      .transaction-item {
        flex-wrap: wrap;
        padding: 14px;
        gap: 12px;
      }

      .transaction-icon {
        width: 44px;
        height: 44px;
      }

      .transaction-icon svg {
        width: 20px;
        height: 20px;
      }

      .transaction-category {
        font-size: 15px;
      }

      .transaction-description {
        font-size: 13px;
      }

      .transaction-amount {
        font-size: 18px;
        margin-right: 0;
        margin-left: auto;
      }

      .transaction-actions {
        width: 100%;
        margin-top: 8px;
      }

      .transaction-actions .btn {
        width: 100%;
      }

      .search-bar {
        display: none;
      }

      .top-bar-actions {
        gap: 8px;
      }

      .currency-selector {
        padding: 6px 12px;
        font-size: 13px;
      }

      .icon-btn {
        width: 36px;
        height: 36px;
      }

      .modal-overlay {
        padding: 0;
        align-items: flex-end;
      }

      .modal {
        padding: 24px 20px;
        margin: 0;
        max-width: 100%;
        width: 100%;
        max-height: 85%;
        border-radius: 20px 20px 0 0;
        animation: slideUpMobile 0.3s;
      }

      @keyframes slideUpMobile {
        from {
          transform: translateY(100%);
        }
        to {
          transform: translateY(0);
        }
      }

      .modal-title {
        font-size: 20px;
      }

      .modal-header {
        margin-bottom: 24px;
      }

      .form-grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }

      .form-group {
        margin-bottom: 0;
      }

      .splash-logo {
        font-size: 48px;
      }

      .splash-tagline {
        font-size: 16px;
      }

      label {
        font-size: 13px;
        margin-bottom: 6px;
      }

      input, select, textarea {
        padding: 14px 16px;
        font-size: 16px;
        min-height: 50px;
      }

      .btn {
        padding: 14px 20px;
        font-size: 15px;
      }

      .filters {
        gap: 8px;
        overflow-x: auto;
        padding-bottom: 8px;
        -webkit-overflow-scrolling: touch;
      }

      .filter-chip {
        white-space: nowrap;
        font-size: 13px;
        padding: 6px 14px;
      }

      .period-selector {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      .period-btn {
        white-space: nowrap;
        font-size: 13px;
      }

      .chart-label {
        width: 100px;
        font-size: 13px;
      }

      .chart-bar-value {
        font-size: 12px;
      }

      .budget-item, .goal-card {
        padding: 16px;
      }

      .budget-category, .goal-name {
        font-size: 15px;
      }

      .info-section h3 {
        font-size: 16px;
      }

      .info-section p, .info-section li {
        font-size: 14px;
      }

      .card-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .card-header .btn {
        width: 100%;
      }

      .empty-state {
        padding: 40px 20px;
      }

      .empty-state-icon {
        width: 64px;
        height: 64px;
      }

      .empty-state-icon svg {
        width: 32px;
        height: 32px;
      }

      .empty-state-title {
        font-size: 18px;
      }

      .empty-state-text {
        font-size: 14px;
      }
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--surface);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--text-tertiary);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body><!-- Splash Screen -->
  <div class="splash-screen" id="splash-screen">
   <div class="splash-logo" id="splash-logo">
    Finance Pro
   </div>
   <div class="splash-tagline" id="splash-tagline">
    Smart Money Management
   </div>
   <div class="splash-loader"></div>
  </div>
  <div class="app-wrapper"><!-- Sidebar -->
   <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
     <div class="logo">
      <div class="logo-icon">
       <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
       </svg>
      </div><span id="app-title">Finance Pro</span>
     </div>
    </div>
    <nav class="nav-menu"><button class="nav-item active" data-page="dashboard">
      <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
      </svg> Dashboard </button> <button class="nav-item" data-page="transactions">
      <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
      </svg> Transactions </button> <button class="nav-item" data-page="analytics">
      <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
      </svg> Analytics </button> <button class="nav-item" data-page="budgets">
      <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
      </svg> Budgets </button> <button class="nav-item" data-page="goals">
      <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
      </svg> Goals </button> <button class="nav-item" data-page="reports">
      <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
      </svg> Reports </button> <button class="nav-item" data-page="settings">
      <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /> <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
      </svg> Settings </button>
    </nav>
    <div class="sidebar-footer"><button class="nav-item" id="theme-toggle">
      <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
      </svg><span id="theme-text">Light Mode</span> </button>
    </div>
   </aside><!-- Main Content -->
   <div class="main-content"><!-- Top Bar -->
    <header class="top-bar"><button class="icon-btn" id="menu-toggle">
      <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
      </svg></button>
     <div class="search-bar">
      <svg class="search-icon" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg><input type="text" placeholder="Search transactions..." id="search-input">
     </div>
     <div class="top-bar-actions"><select class="currency-selector" id="base-currency"> <option value="NGN">NGN ₦</option> <option value="USD">USD $</option> <option value="EUR">EUR €</option> <option value="GBP">GBP £</option> <option value="JPY">JPY ¥</option> <option value="CAD">CAD $</option> <option value="AUD">AUD $</option> <option value="CHF">CHF Fr</option> <option value="CNY">CNY ¥</option> <option value="INR">INR ₹</option> <option value="MXN">MXN $</option> <option value="BRL">BRL R$</option> <option value="ZAR">ZAR R</option> <option value="SGD">SGD $</option> <option value="HKD">HKD $</option> <option value="SEK">SEK kr</option> <option value="NOK">NOK kr</option> <option value="DKK">DKK kr</option> <option value="PLN">PLN zł</option> <option value="THB">THB ฿</option> <option value="IDR">IDR Rp</option> </select> <button class="icon-btn" id="export-btn" title="Export Data">
       <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
       </svg></button>
     </div>
    </header><!-- Content Area -->
    <main class="content-area" id="content-area"><!-- Dashboard Page -->
     <div class="page" id="page-dashboard">
      <div class="page-header">
       <h1 class="page-title">Dashboard</h1>
       <p class="page-subtitle" id="dashboard-subtitle">Your Financial Overview</p>
      </div>
      <div class="period-selector" style="margin-bottom: 24px;"><button class="period-btn" data-period="week">This Week</button> <button class="period-btn active" data-period="month">This Month</button> <button class="period-btn" data-period="year">This Year</button> <button class="period-btn" data-period="all">All Time</button>
      </div>
      <div class="stats-grid">
       <div class="stat-card">
        <div class="stat-header">
         <div>
          <div class="stat-label">
           Total Balance
          </div>
          <div class="stat-value" id="stat-balance">
           ₦0.00
          </div>
          <div class="stat-change positive" id="stat-balance-change">
           <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
           </svg><span>+0%</span>
          </div>
         </div>
         <div class="stat-icon">
          <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" />
          </svg>
         </div>
        </div>
       </div>
       <div class="stat-card income">
        <div class="stat-header">
         <div>
          <div class="stat-label">
           Total Income
          </div>
          <div class="stat-value" id="stat-income">
           ₦0.00
          </div>
          <div class="stat-change positive"><span id="income-count">0 transactions</span>
          </div>
         </div>
         <div class="stat-icon">
          <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M7 11l5-5m0 0l5 5m-5-5v12" />
          </svg>
         </div>
        </div>
       </div>
       <div class="stat-card expense">
        <div class="stat-header">
         <div>
          <div class="stat-label">
           Total Expenses
          </div>
          <div class="stat-value" id="stat-expenses">
           ₦0.00
          </div>
          <div class="stat-change negative"><span id="expense-count">0 transactions</span>
          </div>
         </div>
         <div class="stat-icon">
          <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M17 13l-5 5m0 0l-5-5m5 5V6" />
          </svg>
         </div>
        </div>
       </div>
       <div class="stat-card">
        <div class="stat-header">
         <div>
          <div class="stat-label">
           Savings Rate
          </div>
          <div class="stat-value" id="stat-savings-rate">
           0%
          </div>
          <div class="stat-change positive"><span id="savings-amount">₦0 saved</span>
          </div>
         </div>
         <div class="stat-icon">
          <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
         </div>
        </div>
       </div>
      </div>
      <div class="card">
       <div class="card-header">
        <h2 class="card-title">Recent Transactions</h2><button class="btn btn-secondary" id="view-all-btn">View All</button>
       </div>
       <div class="transaction-list" id="recent-transactions">
        <div class="empty-state">
         <div class="empty-state-icon">
          <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
          </svg>
         </div>
         <div class="empty-state-title">
          No transactions yet
         </div>
         <div class="empty-state-text">
          Click the + button to add your first transaction
         </div>
        </div>
       </div>
      </div>
      <div class="card">
       <div class="card-header">
        <h2 class="card-title">Spending by Category</h2>
       </div>
       <div class="chart-container" id="category-chart">
        <div class="empty-state">
         <div class="empty-state-icon">
          <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
          </svg>
         </div>
         <div class="empty-state-title">
          No data yet
         </div>
         <div class="empty-state-text">
          Add transactions to see category breakdown
         </div>
        </div>
       </div>
      </div>
     </div><!-- Transactions Page -->
     <div class="page" id="page-transactions" style="display: none;">
      <div class="page-header">
       <h1 class="page-title">Transactions</h1>
       <p class="page-subtitle">Manage all your financial transactions across multiple accounts</p>
      </div>
      <div class="card">
       <div class="card-header">
        <h2 class="card-title">All Transactions</h2><button class="btn btn-primary" id="add-transaction-btn">
         <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
         </svg> Add Transaction </button>
       </div>
       <div class="filters"><button class="filter-chip active" data-filter="all">All</button> <button class="filter-chip" data-filter="income">Income</button> <button class="filter-chip" data-filter="expense">Expenses</button> <button class="filter-chip" data-filter="recurring">Recurring</button>
       </div>
       <div class="transaction-list" id="all-transactions">
        <div class="empty-state">
         <div class="empty-state-icon">
          <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
          </svg>
         </div>
         <div class="empty-state-title">
          No transactions yet
         </div>
         <div class="empty-state-text">
          Click "Add Transaction" to get started
         </div>
        </div>
       </div>
      </div>
     </div><!-- Analytics Page -->
     <div class="page" id="page-analytics" style="display: none;">
      <div class="page-header">
       <h1 class="page-title">Analytics</h1>
       <p class="page-subtitle">Deep insights into your spending patterns and financial health</p>
      </div>
      <div class="stats-grid">
       <div class="stat-card">
        <div class="stat-header">
         <div>
          <div class="stat-label">
           Average Transaction
          </div>
          <div class="stat-value" id="avg-transaction">
           ₦0.00
          </div>
         </div>
        </div>
       </div>
       <div class="stat-card">
        <div class="stat-header">
         <div>
          <div class="stat-label">
           Largest Expense
          </div>
          <div class="stat-value" id="largest-expense">
           ₦0.00
          </div>
         </div>
        </div>
       </div>
       <div class="stat-card">
        <div class="stat-header">
         <div>
          <div class="stat-label">
           Most Frequent Category
          </div>
          <div class="stat-value" id="frequent-category" style="font-size: 20px;">
           -
          </div>
         </div>
        </div>
       </div>
      </div>
      <div class="card">
       <div class="card-header">
        <h2 class="card-title">Top Spending Categories</h2>
       </div>
       <div class="chart-container" id="analytics-chart">
        <div class="empty-state">
         <div class="empty-state-icon">
          <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
          </svg>
         </div>
         <div class="empty-state-title">
          No data available
         </div>
         <div class="empty-state-text">
          Add expense transactions to see analytics
         </div>
        </div>
       </div>
      </div>
      <div class="card">
       <div class="card-header">
        <h2 class="card-title">Income vs Expenses Trend</h2>
       </div>
       <p style="color: var(--text-secondary); padding: 20px; text-align: center;">Monthly trend visualization coming soon with interactive charts</p>
      </div>
     </div><!-- Budgets Page -->
     <div class="page" id="page-budgets" style="display: none;">
      <div class="page-header">
       <h1 class="page-title">Budgets</h1>
       <p class="page-subtitle">Set monthly budgets and track your spending by category</p>
      </div>
      <div class="card">
       <div class="card-header">
        <h2 class="card-title">Monthly Budget Overview</h2><button class="btn btn-primary" id="add-budget-btn">
         <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
         </svg> Set Budget </button>
       </div>
       <div id="budget-list">
        <div class="budget-item">
         <div class="budget-header"><span class="budget-category">Food &amp; Dining</span>
          <div class="budget-amounts"><span class="budget-spent" id="food-spent">₦0</span> <span class="budget-total">/ ₦50,000</span>
          </div>
         </div>
         <div class="progress-bar">
          <div class="progress-fill" id="food-progress" style="width: 0%"></div>
         </div>
        </div>
        <div class="budget-item">
         <div class="budget-header"><span class="budget-category">Transportation</span>
          <div class="budget-amounts"><span class="budget-spent" id="transport-spent">₦0</span> <span class="budget-total">/ ₦30,000</span>
          </div>
         </div>
         <div class="progress-bar">
          <div class="progress-fill" id="transport-progress" style="width: 0%"></div>
         </div>
        </div>
        <div class="budget-item">
         <div class="budget-header"><span class="budget-category">Shopping</span>
          <div class="budget-amounts"><span class="budget-spent" id="shopping-spent">₦0</span> <span class="budget-total">/ ₦40,000</span>
          </div>
         </div>
         <div class="progress-bar">
          <div class="progress-fill" id="shopping-progress" style="width: 0%"></div>
         </div>
        </div>
        <div class="budget-item">
         <div class="budget-header"><span class="budget-category">Entertainment</span>
          <div class="budget-amounts"><span class="budget-spent" id="entertainment-spent">₦0</span> <span class="budget-total">/ ₦20,000</span>
          </div>
         </div>
         <div class="progress-bar">
          <div class="progress-fill" id="entertainment-progress" style="width: 0%"></div>
         </div>
        </div>
        <div class="budget-item">
         <div class="budget-header"><span class="budget-category">Bills &amp; Utilities</span>
          <div class="budget-amounts"><span class="budget-spent" id="bills-spent">₦0</span> <span class="budget-total">/ ₦60,000</span>
          </div>
         </div>
         <div class="progress-bar">
          <div class="progress-fill" id="bills-progress" style="width: 0%"></div>
         </div>
        </div>
       </div>
      </div>
      <div class="card">
       <div class="card-header">
        <h2 class="card-title">Budget Tips</h2>
       </div>
       <div class="info-section">
        <p><strong>Pro Tip:</strong> Try to keep your spending below 80% of your budget to have a safety buffer for unexpected expenses.</p>
        <p>Budgets help you stay on track with your financial goals and identify areas where you might be overspending.</p>
       </div>
      </div>
     </div><!-- Goals Page -->
     <div class="page" id="page-goals" style="display: none;">
      <div class="page-header">
       <h1 class="page-title">Savings Goals</h1>
       <p class="page-subtitle">Set and track your financial goals</p>
      </div>
      <div class="card">
       <div class="card-header">
        <h2 class="card-title">Active Goals</h2><button class="btn btn-primary" id="add-goal-btn">
         <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
         </svg> New Goal </button>
       </div>
       <div class="goal-card">
        <div class="goal-header">
         <div>
          <div class="goal-name">
           Emergency Fund
          </div>
          <div class="goal-target">
           Target: ₦500,000
          </div>
         </div>
         <div class="goal-progress" id="emergency-progress">
          ₦0
         </div>
        </div>
        <div class="progress-bar">
         <div class="progress-fill" id="emergency-bar" style="width: 0%"></div>
        </div>
       </div>
       <div class="goal-card">
        <div class="goal-header">
         <div>
          <div class="goal-name">
           Vacation Fund
          </div>
          <div class="goal-target">
           Target: ₦300,000
          </div>
         </div>
         <div class="goal-progress" id="vacation-progress">
          ₦0
         </div>
        </div>
        <div class="progress-bar">
         <div class="progress-fill" id="vacation-bar" style="width: 0%"></div>
        </div>
       </div>
       <div class="goal-card">
        <div class="goal-header">
         <div>
          <div class="goal-name">
           New Laptop
          </div>
          <div class="goal-target">
           Target: ₦200,000
          </div>
         </div>
         <div class="goal-progress" id="laptop-progress">
          ₦0
         </div>
        </div>
        <div class="progress-bar">
         <div class="progress-fill" id="laptop-bar" style="width: 0%"></div>
        </div>
       </div>
      </div>
      <div class="card">
       <div class="card-header">
        <h2 class="card-title">Goal Setting Tips</h2>
       </div>
       <div class="info-section">
        <ul>
         <li>Set specific, measurable goals with clear target amounts</li>
         <li>Break large goals into smaller milestones</li>
         <li>Automate savings by setting up recurring transfers</li>
         <li>Review and adjust your goals quarterly</li>
         <li>Celebrate when you reach milestones!</li>
        </ul>
       </div>
      </div>
     </div><!-- Reports Page -->
     <div class="page" id="page-reports" style="display: none;">
      <div class="page-header">
       <h1 class="page-title">Financial Reports</h1>
       <p class="page-subtitle">Comprehensive analysis of your financial activity</p>
      </div>
      <div class="card">
       <div class="card-header">
        <h2 class="card-title">Monthly Summary</h2><select class="currency-selector" id="report-month"> <option value="current">Current Month</option> <option value="last">Last Month</option> <option value="2months">2 Months Ago</option> </select>
       </div>
       <div class="stats-grid">
        <div class="stat-card">
         <div class="stat-label">
          Total Transactions
         </div>
         <div class="stat-value" id="report-total-transactions">
          0
         </div>
        </div>
        <div class="stat-card">
         <div class="stat-label">
          Net Cash Flow
         </div>
         <div class="stat-value" id="report-net-flow">
          ₦0
         </div>
        </div>
        <div class="stat-card">
         <div class="stat-label">
          Avg Daily Spending
         </div>
         <div class="stat-value" id="report-daily-avg">
          ₦0
         </div>
        </div>
       </div>
      </div>
      <div class="card">
       <div class="card-header">
        <h2 class="card-title">Category Breakdown</h2>
       </div>
       <div class="chart-container" id="report-chart">
        <div class="empty-state">
         <div class="empty-state-icon">
          <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
         </div>
         <div class="empty-state-title">
          No report data
         </div>
         <div class="empty-state-text">
          Add transactions to generate reports
         </div>
        </div>
       </div>
      </div>
      <div class="card">
       <div class="card-header">
        <h2 class="card-title">Financial Insights</h2>
       </div>
       <div class="info-section" id="insights-container">
        <p style="color: var(--text-tertiary); text-align: center; padding: 20px;">Add more transactions to get personalized insights</p>
       </div>
      </div>
     </div><!-- Settings Page -->
     <div class="page" id="page-settings" style="display: none;">
      <div class="page-header">
       <h1 class="page-title">Settings</h1>
       <p class="page-subtitle">Customize your experience and manage your data</p>
      </div>
      <div class="card">
       <div class="card-header">
        <h2 class="card-title">Preferences</h2>
       </div>
       <div class="form-group"><label for="settings-currency">Base Currency</label> <select id="settings-currency" class="currency-selector" style="width: 100%; max-width: 300px;"> <option value="NGN">NGN - Nigerian Naira (₦)</option> <option value="USD">USD - US Dollar ($)</option> <option value="EUR">EUR - Euro (€)</option> <option value="GBP">GBP - British Pound (£)</option> <option value="JPY">JPY - Japanese Yen (¥)</option> <option value="CAD">CAD - Canadian Dollar ($)</option> <option value="AUD">AUD - Australian Dollar ($)</option> <option value="CHF">CHF - Swiss Franc (Fr)</option> <option value="CNY">CNY - Chinese Yuan (¥)</option> <option value="INR">INR - Indian Rupee (₹)</option> <option value="MXN">MXN - Mexican Peso ($)</option> <option value="BRL">BRL - Brazilian Real (R$)</option> <option value="ZAR">ZAR - South African Rand (R)</option> <option value="SGD">SGD - Singapore Dollar ($)</option> <option value="HKD">HKD - Hong Kong Dollar ($)</option> <option value="SEK">SEK - Swedish Krona (kr)</option> <option value="NOK">NOK - Norwegian Krone (kr)</option> <option value="DKK">DKK - Danish Krone (kr)</option> <option value="PLN">PLN - Polish Zloty (zł)</option> <option value="THB">THB - Thai Baht (฿)</option> <option value="IDR">IDR - Indonesian Rupiah (Rp)</option> </select>
       </div>
       <div class="form-group" style="margin-top: 20px;"><label>Auto Theme Switching</label>
        <div class="checkbox-group"><input type="checkbox" id="auto-theme-toggle"> <label for="auto-theme-toggle">Automatically switch between light and dark mode based on time of day (6 AM - 6 PM = Light Mode)</label>
        </div>
       </div>
      </div>
      <div class="card">
       <div class="card-header">
        <h2 class="card-title">Data Management</h2>
       </div>
       <p style="color: var(--text-secondary); margin-bottom: 16px;">All your data is stored securely in your Canva sheet. You can export or manage it anytime.</p><button class="btn btn-secondary" id="export-csv-btn">
        <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
        </svg> Export to CSV </button>
      </div>
      <div class="card">
       <div class="card-header">
        <h2 class="card-title">Information</h2>
       </div>
       <div style="display: flex; gap: 12px; flex-wrap: wrap;"><button class="btn btn-secondary" id="about-btn">
         <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
         </svg> About App </button> <button class="btn btn-secondary" id="privacy-btn">
         <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
         </svg> Privacy Policy </button>
       </div>
      </div>
     </div>
    </main>
   </div>
  </div><!-- FAB --> <button class="fab" id="fab-add">
   <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
   </svg></button> <!-- Transaction Modal -->
  <div class="modal-overlay" id="transaction-modal">
   <div class="modal">
    <div class="modal-header">
     <h3 class="modal-title" id="modal-title">Add Transaction</h3><button class="close-btn" id="close-modal">
      <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <form id="transaction-form">
     <div style="margin-bottom: 24px;">
      <h4 style="font-size: 15px; font-weight: 700; color: var(--text-primary); margin-bottom: 16px; text-transform: uppercase; letter-spacing: 0.5px;">Transaction Details</h4>
      <div class="form-grid">
       <div class="form-group"><label for="transaction-type">Type</label> <select id="transaction-type" required> <option value="income">Income</option> <option value="expense">Expense</option> </select>
       </div>
       <div class="form-group"><label for="transaction-amount">Amount</label> <input type="number" id="transaction-amount" step="0.01" min="0" placeholder="0.00" required>
       </div>
       <div class="form-group"><label for="transaction-currency">Currency</label> <select id="transaction-currency" required> <option value="NGN">NGN ₦</option> <option value="USD">USD $</option> <option value="EUR">EUR €</option> <option value="GBP">GBP £</option> <option value="JPY">JPY ¥</option> <option value="CAD">CAD $</option> <option value="AUD">AUD $</option> <option value="CHF">CHF Fr</option> <option value="CNY">CNY ¥</option> <option value="INR">INR ₹</option> <option value="MXN">MXN $</option> <option value="BRL">BRL R$</option> <option value="ZAR">ZAR R</option> <option value="SGD">SGD $</option> <option value="HKD">HKD $</option> <option value="SEK">SEK kr</option> <option value="NOK">NOK kr</option> <option value="DKK">DKK kr</option> <option value="PLN">PLN zł</option> <option value="THB">THB ฿</option> <option value="IDR">IDR Rp</option> </select>
       </div>
       <div class="form-group"><label for="transaction-date">Date</label> <input type="date" id="transaction-date" required>
       </div>
      </div>
     </div>
     <div style="margin-bottom: 24px;">
      <h4 style="font-size: 15px; font-weight: 700; color: var(--text-primary); margin-bottom: 16px; text-transform: uppercase; letter-spacing: 0.5px;">Categorization</h4>
      <div class="form-group"><label for="transaction-category">Category</label> <select id="transaction-category" required> <optgroup label="Income Categories"> <option value="Salary">Salary</option> <option value="Freelance">Freelance</option> <option value="Investment">Investment</option> <option value="Gift">Gift</option> <option value="Other Income">Other Income</option> </optgroup> <optgroup label="Expense Categories"> <option value="Food &amp; Dining">Food &amp; Dining</option> <option value="Transportation">Transportation</option> <option value="Shopping">Shopping</option> <option value="Entertainment">Entertainment</option> <option value="Bills &amp; Utilities">Bills &amp; Utilities</option> <option value="Healthcare">Healthcare</option> <option value="Education">Education</option> <option value="Travel">Travel</option> <option value="Housing">Housing</option> <option value="Insurance">Insurance</option> <option value="Other Expense">Other Expense</option> </optgroup> </select>
      </div>
      <div class="form-group"><label for="transaction-account">Account</label> <select id="transaction-account" required> <option value="Main Account">Main Account</option> <option value="Savings">Savings</option> <option value="Cash">Cash</option> <option value="Credit Card">Credit Card</option> </select>
      </div>
     </div>
     <div style="margin-bottom: 24px;">
      <h4 style="font-size: 15px; font-weight: 700; color: var(--text-primary); margin-bottom: 16px; text-transform: uppercase; letter-spacing: 0.5px;">Additional Information</h4>
      <div class="form-group full-width"><label for="transaction-description">Description</label> <textarea id="transaction-description" placeholder="Optional notes about this transaction"></textarea>
      </div>
      <div class="form-group full-width"><label for="transaction-tags">Tags (comma-separated)</label> <input type="text" id="transaction-tags" placeholder="e.g., business, tax-deductible, vacation">
      </div>
      <div class="checkbox-group"><input type="checkbox" id="transaction-recurring"> <label for="transaction-recurring">This is a recurring transaction</label>
      </div>
     </div>
     <div style="display: flex; gap: 12px; margin-top: 24px;"><button type="submit" class="btn btn-primary" style="flex: 1;" id="submit-btn"> <span id="submit-text">Add Transaction</span> </button> <button type="button" class="btn btn-secondary" id="cancel-btn" style="min-width: 120px;">Cancel</button>
     </div>
    </form>
   </div>
  </div><!-- About Modal -->
  <div class="modal-overlay" id="about-modal">
   <div class="modal">
    <div class="modal-header">
     <h3 class="modal-title">About Finance Pro</h3><button class="close-btn" id="close-about">
      <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <div class="info-section">
     <h3>What is Finance Pro?</h3>
     <p>Finance Pro is a comprehensive personal finance management application designed to help you take control of your money. Track income, expenses, set budgets, achieve savings goals, and gain valuable insights into your spending habits.</p>
     <h3>Key Features</h3>
     <ul>
      <li>Multi-currency transaction tracking with real-time conversion</li>
      <li>Comprehensive dashboard with financial overview</li>
      <li>Category-based spending analysis and charts</li>
      <li>Monthly budget tracking with visual progress bars</li>
      <li>Savings goals with milestone tracking</li>
      <li>Detailed financial reports and insights</li>
      <li>Multi-account support (Bank, Cash, Credit Card, Savings)</li>
      <li>Recurring transaction management</li>
      <li>Tag-based organization</li>
      <li>CSV export for external analysis</li>
      <li>Auto dark/light mode switching</li>
      <li>Fully responsive design for all devices</li>
     </ul>
     <h3>Developer</h3>
     <p>Built with care by <a href="https://sisco-ask.vercel.app" target="_blank" rel="noopener noreferrer" class="developer-link">Sisqo</a></p>
     <p style="font-size: 14px; color: var(--text-tertiary);">Finance Pro is designed to make personal finance management simple, intuitive, and powerful. Your financial data is stored securely in your Canva sheet and never leaves your control.</p>
     <h3>Version</h3>
     <p>Version 2.0.0 - Enhanced Edition</p>
     <p style="font-size: 13px; color: var(--text-tertiary);">Last Updated: 2024</p>
    </div>
   </div>
  </div><!-- Privacy Modal -->
  <div class="modal-overlay" id="privacy-modal">
   <div class="modal">
    <div class="modal-header">
     <h3 class="modal-title">Privacy Policy</h3><button class="close-btn" id="close-privacy">
      <svg fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <div class="info-section">
     <h3>Your Privacy Matters</h3>
     <p>Finance Pro is committed to protecting your privacy and ensuring the security of your financial data.</p>
     <h3>Data Collection</h3>
     <p>Finance Pro collects only the financial transaction data you explicitly enter into the application, including:</p>
     <ul>
      <li>Transaction amounts, dates, and categories</li>
      <li>Account information you specify</li>
      <li>Tags and descriptions you add</li>
      <li>Budget and goal settings</li>
     </ul>
     <h3>Data Storage</h3>
     <p>All your financial data is stored exclusively in your personal Canva sheet. This means:</p>
     <ul>
      <li>You have complete ownership and control of your data</li>
      <li>Your data is not stored on external servers</li>
      <li>Only you can access your financial information</li>
      <li>You can export or delete your data at any time</li>
     </ul>
     <h3>Data Security</h3>
     <ul>
      <li>No financial data is transmitted to third-party services</li>
      <li>Currency conversion rates are simulated locally</li>
      <li>No tracking or analytics are performed on your data</li>
      <li>Your data never leaves the Canva environment</li>
     </ul>
     <h3>What We Don't Do</h3>
     <ul>
      <li>We don't sell your data to anyone</li>
      <li>We don't share your data with advertisers</li>
      <li>We don't use your data for marketing purposes</li>
      <li>We don't track your browsing or usage patterns</li>
     </ul>
     <h3>Contact</h3>
     <p>If you have questions about this privacy policy, please contact the developer at <a href="https://sisco-ask.vercel.app" target="_blank" rel="noopener noreferrer" class="developer-link">sisco-ask.vercel.app</a></p>
     <p style="font-size: 13px; color: var(--text-tertiary); margin-top: 24px;">Last Updated: 2024 | Finance Pro v2.0.0</p>
    </div>
   </div>
  </div><!-- Toast -->
  <div class="toast" id="toast">
   <svg class="toast-icon" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
   </svg><span class="toast-message" id="toast-message"></span>
  </div>
  <script>
    // Currency exchange rates (simulated - relative to NGN)
    const exchangeRates = {
      NGN: 1,
      USD: 0.0013,
      EUR: 0.0012,
      GBP: 0.0010,
      JPY: 0.19,
      CAD: 0.0017,
      AUD: 0.0020,
      CHF: 0.0011,
      CNY: 0.0093,
      INR: 0.11,
      MXN: 0.022,
      BRL: 0.0064,
      ZAR: 0.024,
      SGD: 0.0017,
      HKD: 0.010,
      SEK: 0.014,
      NOK: 0.014,
      DKK: 0.0089,
      PLN: 0.0051,
      THB: 0.046,
      IDR: 20.2
    };

    const currencySymbols = {
      NGN: '₦',
      USD: '$',
      EUR: '€',
      GBP: '£',
      JPY: '¥',
      CAD: '$',
      AUD: '$',
      CHF: 'Fr',
      CNY: '¥',
      INR: '₹',
      MXN: '$',
      BRL: 'R$',
      ZAR: 'R',
      SGD: '$',
      HKD: '$',
      SEK: 'kr',
      NOK: 'kr',
      DKK: 'kr',
      PLN: 'zł',
      THB: '฿',
      IDR: 'Rp'
    };

    let allTransactions = [];
    let currentFilter = 'all';
    let currentPage = 'dashboard';
    let baseCurrency = 'NGN';
    let isDarkMode = false;
    let searchQuery = '';
    let currentPeriod = 'month';
    let autoThemeEnabled = false;

    const defaultConfig = {
      app_title: 'Finance Pro',
      dashboard_subtitle: 'Your Financial Overview',
      splash_tagline: 'Smart Money Management'
    };

    // Data SDK Handler
    const dataHandler = {
      onDataChanged(data) {
        // CRITICAL: Only update local data and UI - NEVER call SDK methods here
        allTransactions = data.sort((a, b) => new Date(b.date) - new Date(a.date));
        
        // Update all pages since data changed
        updateDashboard();
        renderTransactions();
        updateAnalytics();
        updateBudgets();
        updateGoals();
        updateReports();
      }
    };

    // Config Change Handler
    async function onConfigChange(config) {
      const appTitle = config.app_title || defaultConfig.app_title;
      const dashboardSubtitle = config.dashboard_subtitle || defaultConfig.dashboard_subtitle;
      const splashTagline = config.splash_tagline || defaultConfig.splash_tagline;

      document.getElementById('app-title').textContent = appTitle;
      document.getElementById('dashboard-subtitle').textContent = dashboardSubtitle;
      
      const splashLogoEl = document.getElementById('splash-logo');
      const splashTaglineEl = document.getElementById('splash-tagline');
      if (splashLogoEl) splashLogoEl.textContent = appTitle;
      if (splashTaglineEl) splashTaglineEl.textContent = splashTagline;
    }

    // Currency conversion
    function convertCurrency(amount, fromCurrency, toCurrency) {
      if (fromCurrency === toCurrency) return amount;
      const inNGN = amount / exchangeRates[fromCurrency];
      return inNGN * exchangeRates[toCurrency];
    }

    function formatCurrency(amount, currency = baseCurrency) {
      const symbol = currencySymbols[currency];
      return `${symbol}${Math.abs(amount).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
    }

    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    }

    // Filter transactions by period
    function filterByPeriod(transactions) {
      const now = new Date();
      const filtered = transactions.filter(t => {
        const transDate = new Date(t.date);
        
        if (currentPeriod === 'week') {
          const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
          return transDate >= weekAgo;
        } else if (currentPeriod === 'month') {
          return transDate.getMonth() === now.getMonth() && transDate.getFullYear() === now.getFullYear();
        } else if (currentPeriod === 'year') {
          return transDate.getFullYear() === now.getFullYear();
        }
        return true; // 'all'
      });
      
      return filtered;
    }

    // Update Dashboard
    function updateDashboard() {
      const periodTransactions = filterByPeriod(allTransactions);
      
      const income = periodTransactions
        .filter(t => t.type === 'income')
        .reduce((sum, t) => sum + convertCurrency(t.amount, t.currency, baseCurrency), 0);

      const expenses = periodTransactions
        .filter(t => t.type === 'expense')
        .reduce((sum, t) => sum + convertCurrency(t.amount, t.currency, baseCurrency), 0);

      const balance = income - expenses;
      const savingsRate = income > 0 ? ((balance / income) * 100).toFixed(1) : 0;

      document.getElementById('stat-balance').textContent = formatCurrency(balance);
      document.getElementById('stat-income').textContent = formatCurrency(income);
      document.getElementById('stat-expenses').textContent = formatCurrency(expenses);
      document.getElementById('stat-savings-rate').textContent = `${savingsRate}%`;
      document.getElementById('savings-amount').textContent = `${formatCurrency(balance)} saved`;

      const incomeCount = periodTransactions.filter(t => t.type === 'income').length;
      const expenseCount = periodTransactions.filter(t => t.type === 'expense').length;

      document.getElementById('income-count').textContent = `${incomeCount} transaction${incomeCount !== 1 ? 's' : ''}`;
      document.getElementById('expense-count').textContent = `${expenseCount} transaction${expenseCount !== 1 ? 's' : ''}`;

      // Recent transactions
      const recentContainer = document.getElementById('recent-transactions');
      const recent = allTransactions.slice(0, 5);

      if (recent.length === 0) {
        recentContainer.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">
              <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
              </svg>
            </div>
            <div class="empty-state-title">No transactions yet</div>
            <div class="empty-state-text">Click the + button to add your first transaction</div>
          </div>
        `;
      } else {
        recentContainer.innerHTML = recent.map(t => createTransactionHTML(t)).join('');
        attachTransactionListeners();
      }

      // Category chart
      updateCategoryChart('category-chart');
    }

    // Update Category Chart
    function updateCategoryChart(containerId) {
      const container = document.getElementById(containerId);
      const periodTransactions = filterByPeriod(allTransactions);
      const expenses = periodTransactions.filter(t => t.type === 'expense');

      if (expenses.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">
              <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
              </svg>
            </div>
            <div class="empty-state-title">No data yet</div>
            <div class="empty-state-text">Add transactions to see category breakdown</div>
          </div>
        `;
        return;
      }

      const categoryTotals = {};
      expenses.forEach(t => {
        const amount = convertCurrency(t.amount, t.currency, baseCurrency);
        categoryTotals[t.category] = (categoryTotals[t.category] || 0) + amount;
      });

      const sorted = Object.entries(categoryTotals).sort((a, b) => b[1] - a[1]).slice(0, 5);
      const maxAmount = sorted[0][1];

      container.innerHTML = sorted.map(([category, amount]) => {
        const percentage = (amount / maxAmount) * 100;
        return `
          <div class="chart-bar">
            <div class="chart-label">${category}</div>
            <div class="chart-bar-bg">
              <div class="chart-bar-fill" style="width: ${percentage}%">
                <span class="chart-bar-value">${formatCurrency(amount)}</span>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    // Create Transaction HTML
    function createTransactionHTML(transaction) {
      const amount = convertCurrency(transaction.amount, transaction.currency, baseCurrency);
      const tags = transaction.tags ? transaction.tags.split(',').map(t => t.trim()).filter(t => t) : [];

      return `
        <div class="transaction-item" data-id="${transaction.__backendId}">
          <div class="transaction-icon ${transaction.type}">
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              ${transaction.type === 'income' 
                ? '<path stroke-linecap="round" stroke-linejoin="round" d="M7 11l5-5m0 0l5 5m-5-5v12"/>'
                : '<path stroke-linecap="round" stroke-linejoin="round" d="M17 13l-5 5m0 0l-5-5m5 5V6"/>'}
            </svg>
          </div>
          <div class="transaction-details">
            <div class="transaction-category">${transaction.category}</div>
            <div class="transaction-description">${transaction.description || 'No description'} • ${transaction.account || 'Main Account'}</div>
            <div class="transaction-meta">
              <span class="transaction-date">${formatDate(transaction.date)}</span>
              ${transaction.recurring ? '<span class="transaction-recurring">Recurring</span>' : ''}
              ${tags.map(tag => `<span class="transaction-tag">#${tag}</span>`).join('')}
            </div>
          </div>
          <div class="transaction-amount ${transaction.type}">
            ${transaction.type === 'income' ? '+' : '-'}${formatCurrency(amount)}
          </div>
          <div class="transaction-actions">
            <button class="btn btn-danger delete-btn" data-id="${transaction.__backendId}">Delete</button>
          </div>
        </div>
      `;
    }

    // Render Transactions
    function renderTransactions() {
      const container = document.getElementById('all-transactions');
      let filtered = allTransactions;

      if (currentFilter === 'income') {
        filtered = allTransactions.filter(t => t.type === 'income');
      } else if (currentFilter === 'expense') {
        filtered = allTransactions.filter(t => t.type === 'expense');
      } else if (currentFilter === 'recurring') {
        filtered = allTransactions.filter(t => t.recurring);
      }

      if (searchQuery) {
        filtered = filtered.filter(t => 
          t.category.toLowerCase().includes(searchQuery.toLowerCase()) ||
          (t.description && t.description.toLowerCase().includes(searchQuery.toLowerCase())) ||
          (t.tags && t.tags.toLowerCase().includes(searchQuery.toLowerCase())) ||
          (t.account && t.account.toLowerCase().includes(searchQuery.toLowerCase()))
        );
      }

      if (filtered.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">
              <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
              </svg>
            </div>
            <div class="empty-state-title">No transactions found</div>
            <div class="empty-state-text">Try adjusting your filters or add a new transaction</div>
          </div>
        `;
      } else {
        container.innerHTML = filtered.map(t => createTransactionHTML(t)).join('');
        attachTransactionListeners();
      }
    }

    // Update Analytics
    function updateAnalytics() {
      updateCategoryChart('analytics-chart');

      const expenses = allTransactions.filter(t => t.type === 'expense');
      const income = allTransactions.filter(t => t.type === 'income');

      if (allTransactions.length > 0) {
        const avgAmount = allTransactions.reduce((sum, t) => 
          sum + convertCurrency(t.amount, t.currency, baseCurrency), 0) / allTransactions.length;
        document.getElementById('avg-transaction').textContent = formatCurrency(avgAmount);
      }

      if (expenses.length > 0) {
        const largest = Math.max(...expenses.map(t => convertCurrency(t.amount, t.currency, baseCurrency)));
        document.getElementById('largest-expense').textContent = formatCurrency(largest);

        // Most frequent category
        const categoryCounts = {};
        expenses.forEach(t => {
          categoryCounts[t.category] = (categoryCounts[t.category] || 0) + 1;
        });
        const mostFrequent = Object.entries(categoryCounts).sort((a, b) => b[1] - a[1])[0];
        document.getElementById('frequent-category').textContent = mostFrequent ? mostFrequent[0] : '-';
      }
    }

    // Update Budgets
    function updateBudgets() {
      const now = new Date();
      const monthExpenses = allTransactions.filter(t => {
        const transDate = new Date(t.date);
        return t.type === 'expense' && 
               transDate.getMonth() === now.getMonth() && 
               transDate.getFullYear() === now.getFullYear();
      });

      const budgets = {
        'Food & Dining': { spent: 0, limit: 50000, id: 'food' },
        'Transportation': { spent: 0, limit: 30000, id: 'transport' },
        'Shopping': { spent: 0, limit: 40000, id: 'shopping' },
        'Entertainment': { spent: 0, limit: 20000, id: 'entertainment' },
        'Bills & Utilities': { spent: 0, limit: 60000, id: 'bills' }
      };

      monthExpenses.forEach(t => {
        if (budgets[t.category]) {
          budgets[t.category].spent += convertCurrency(t.amount, t.currency, baseCurrency);
        }
      });

      Object.entries(budgets).forEach(([category, data]) => {
        const percentage = Math.min((data.spent / data.limit) * 100, 100);
        const spentEl = document.getElementById(`${data.id}-spent`);
        const progressEl = document.getElementById(`${data.id}-progress`);
        
        if (spentEl) spentEl.textContent = formatCurrency(data.spent);
        if (progressEl) {
          progressEl.style.width = `${percentage}%`;
          progressEl.className = 'progress-fill';
          if (percentage > 90) progressEl.classList.add('danger');
          else if (percentage > 75) progressEl.classList.add('warning');
        }
      });
    }

    // Update Goals
    function updateGoals() {
      const totalIncome = allTransactions
        .filter(t => t.type === 'income')
        .reduce((sum, t) => sum + convertCurrency(t.amount, t.currency, baseCurrency), 0);
      
      const totalExpenses = allTransactions
        .filter(t => t.type === 'expense')
        .reduce((sum, t) => sum + convertCurrency(t.amount, t.currency, baseCurrency), 0);
      
      const savings = totalIncome - totalExpenses;

      // Distribute savings across goals (simplified)
      const emergencyAmount = Math.max(0, Math.min(savings * 0.5, 500000));
      const vacationAmount = Math.max(0, Math.min(savings * 0.3, 300000));
      const laptopAmount = Math.max(0, Math.min(savings * 0.2, 200000));

      const emergencyPct = (emergencyAmount / 500000) * 100;
      const vacationPct = (vacationAmount / 300000) * 100;
      const laptopPct = (laptopAmount / 200000) * 100;

      document.getElementById('emergency-progress').textContent = formatCurrency(emergencyAmount);
      document.getElementById('emergency-bar').style.width = `${emergencyPct}%`;

      document.getElementById('vacation-progress').textContent = formatCurrency(vacationAmount);
      document.getElementById('vacation-bar').style.width = `${vacationPct}%`;

      document.getElementById('laptop-progress').textContent = formatCurrency(laptopAmount);
      document.getElementById('laptop-bar').style.width = `${laptopPct}%`;
    }

    // Update Reports
    function updateReports() {
      const now = new Date();
      const monthTransactions = allTransactions.filter(t => {
        const transDate = new Date(t.date);
        return transDate.getMonth() === now.getMonth() && transDate.getFullYear() === now.getFullYear();
      });

      document.getElementById('report-total-transactions').textContent = monthTransactions.length;

      const income = monthTransactions
        .filter(t => t.type === 'income')
        .reduce((sum, t) => sum + convertCurrency(t.amount, t.currency, baseCurrency), 0);
      
      const expenses = monthTransactions
        .filter(t => t.type === 'expense')
        .reduce((sum, t) => sum + convertCurrency(t.amount, t.currency, baseCurrency), 0);

      document.getElementById('report-net-flow').textContent = formatCurrency(income - expenses);
      
      const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
      const dailyAvg = expenses / daysInMonth;
      document.getElementById('report-daily-avg').textContent = formatCurrency(dailyAvg);

      updateCategoryChart('report-chart');

      // Generate insights
      const insightsContainer = document.getElementById('insights-container');
      if (monthTransactions.length > 5) {
        const savingsRate = income > 0 ? ((income - expenses) / income * 100).toFixed(1) : 0;
        insightsContainer.innerHTML = `
          <p>Your savings rate this month is <strong>${savingsRate}%</strong></p>
          <p>You've made <strong>${monthTransactions.length} transactions</strong> this month</p>
          <p>Your average daily spending is <strong>${formatCurrency(dailyAvg)}</strong></p>
          ${savingsRate > 20 ? '<p><strong>Great job!</strong> You\'re saving over 20% of your income!</p>' : ''}
          ${savingsRate < 10 ? '<p><strong>Tip:</strong> Consider reviewing your expenses to increase your savings rate</p>' : ''}
        `;
      } else {
        insightsContainer.innerHTML = '<p style="color: var(--text-tertiary); text-align: center; padding: 20px;">Add more transactions to get personalized insights</p>';
      }
    }

    // Attach Transaction Listeners
    function attachTransactionListeners() {
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', handleDelete);
      });
    }

    // Handle Delete
    async function handleDelete(e) {
      const transactionId = e.target.dataset.id;
      const transaction = allTransactions.find(t => t.__backendId === transactionId);

      if (!transaction) return;

      const deleteBtn = e.target;

      if (deleteBtn.textContent === 'Delete') {
        deleteBtn.textContent = 'Confirm?';
        deleteBtn.style.background = 'var(--danger)';
        deleteBtn.style.color = 'white';
        deleteBtn.style.border = 'none';

        setTimeout(() => {
          if (deleteBtn.textContent === 'Confirm?') {
            deleteBtn.textContent = 'Delete';
            deleteBtn.style.background = '';
            deleteBtn.style.color = '';
            deleteBtn.style.border = '';
          }
        }, 3000);
        return;
      }

      deleteBtn.disabled = true;
      deleteBtn.textContent = 'Deleting...';

      const result = await window.dataSdk.delete(transaction);

      if (result.isOk) {
        showToast('Transaction deleted!', 'success');
      } else {
        showToast('Failed to delete. Try again.', 'error');
        deleteBtn.disabled = false;
        deleteBtn.textContent = 'Delete';
        deleteBtn.style.background = '';
        deleteBtn.style.color = '';
        deleteBtn.style.border = '';
      }
    }

    // Modal Functions
    function openModal() {
      const modal = document.getElementById('transaction-modal');
      const form = document.getElementById('transaction-form');
      
      form.reset();
      document.getElementById('transaction-date').valueAsDate = new Date();
      document.getElementById('transaction-currency').value = baseCurrency;
      document.getElementById('modal-title').textContent = 'Add Transaction';
      document.getElementById('submit-text').textContent = 'Add Transaction';
      
      modal.classList.add('active');
    }

    function closeModal() {
      document.getElementById('transaction-modal').classList.remove('active');
    }

    // Handle Form Submit
    async function handleSubmit(e) {
      e.preventDefault();

      if (allTransactions.length >= 999) {
        showToast('Maximum limit of 999 transactions reached. Please delete some transactions first.', 'error');
        return;
      }

      const submitBtn = document.getElementById('submit-btn');
      const submitText = document.getElementById('submit-text');
      const originalText = submitText.textContent;

      submitBtn.disabled = true;
      submitText.textContent = 'Adding...';

      const formData = {
        id: Date.now().toString(),
        type: document.getElementById('transaction-type').value,
        amount: parseFloat(document.getElementById('transaction-amount').value),
        currency: document.getElementById('transaction-currency').value,
        category: document.getElementById('transaction-category').value,
        description: document.getElementById('transaction-description').value,
        date: document.getElementById('transaction-date').value,
        tags: document.getElementById('transaction-tags').value,
        recurring: document.getElementById('transaction-recurring').checked,
        account: document.getElementById('transaction-account').value,
        createdAt: new Date().toISOString()
      };

      const result = await window.dataSdk.create(formData);

      submitBtn.disabled = false;
      submitText.textContent = originalText;

      if (result.isOk) {
        showToast('Transaction added successfully!', 'success');
        closeModal();
      } else {
        showToast('Failed to add transaction. Please try again.', 'error');
      }
    }

    // Show Toast
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toast-message');

      toastMessage.textContent = message;
      toast.className = `toast show ${type}`;

      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // Navigation
    function navigateTo(page) {
      document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
      document.getElementById(`page-${page}`).style.display = 'block';

      document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
      const navItem = document.querySelector(`[data-page="${page}"]`);
      if (navItem) navItem.classList.add('active');

      currentPage = page;

      if (page === 'transactions') {
        renderTransactions();
      } else if (page === 'analytics') {
        updateAnalytics();
      } else if (page === 'budgets') {
        updateBudgets();
      } else if (page === 'goals') {
        updateGoals();
      } else if (page === 'reports') {
        updateReports();
      }
    }

    // Theme Toggle
    function toggleTheme() {
      isDarkMode = !isDarkMode;
      document.body.classList.toggle('dark-mode');
      document.getElementById('theme-text').textContent = isDarkMode ? 'Dark Mode' : 'Light Mode';
    }

    // Auto Theme Switching
    function checkAutoTheme() {
      if (!autoThemeEnabled) return;
      
      const hour = new Date().getHours();
      const shouldBeDark = hour < 6 || hour >= 18;
      
      if (shouldBeDark && !isDarkMode) {
        toggleTheme();
      } else if (!shouldBeDark && isDarkMode) {
        toggleTheme();
      }
    }

    // Export CSV - FIXED VERSION
    function exportCSV() {
      if (allTransactions.length === 0) {
        showToast('No transactions to export', 'error');
        return;
      }

      try {
        const headers = ['Date', 'Type', 'Category', 'Amount', 'Currency', 'Account', 'Description', 'Tags', 'Recurring'];
        const rows = allTransactions.map(t => [
          t.date,
          t.type,
          t.category,
          t.amount,
          t.currency,
          t.account || 'Main Account',
          (t.description || '').replace(/"/g, '""'),
          (t.tags || '').replace(/"/g, '""'),
          t.recurring ? 'Yes' : 'No'
        ]);

        const csvContent = [headers, ...rows]
          .map(row => row.map(cell => `"${cell}"`).join(','))
          .join('\n');

        const BOM = '\uFEFF';
        const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });
        
        const url = window.URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `finance-export-${new Date().toISOString().split('T')[0]}.csv`;
        link.style.display = 'none';
        
        document.body.appendChild(link);
        link.click();
        
        setTimeout(() => {
          document.body.removeChild(link);
          window.URL.revokeObjectURL(url);
        }, 100);

        showToast('Data exported successfully! Check your downloads.', 'success');
      } catch (error) {
        console.error('Export error:', error);
        showToast('Export failed. Please try again.', 'error');
      }
    }

    // Event Listeners
    document.getElementById('add-transaction-btn').addEventListener('click', openModal);
    document.getElementById('fab-add').addEventListener('click', openModal);
    document.getElementById('close-modal').addEventListener('click', closeModal);
    document.getElementById('cancel-btn').addEventListener('click', closeModal);
    document.getElementById('transaction-form').addEventListener('submit', handleSubmit);
    document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
    document.getElementById('export-btn').addEventListener('click', exportCSV);
    document.getElementById('export-csv-btn').addEventListener('click', exportCSV);
    document.getElementById('view-all-btn').addEventListener('click', () => navigateTo('transactions'));

    document.getElementById('menu-toggle').addEventListener('click', () => {
      document.getElementById('sidebar').classList.toggle('open');
    });

    document.getElementById('transaction-modal').addEventListener('click', (e) => {
      if (e.target.id === 'transaction-modal') closeModal();
    });

    // About & Privacy modals
    document.getElementById('about-btn').addEventListener('click', () => {
      document.getElementById('about-modal').classList.add('active');
    });

    document.getElementById('close-about').addEventListener('click', () => {
      document.getElementById('about-modal').classList.remove('active');
    });

    document.getElementById('about-modal').addEventListener('click', (e) => {
      if (e.target.id === 'about-modal') {
        document.getElementById('about-modal').classList.remove('active');
      }
    });

    document.getElementById('privacy-btn').addEventListener('click', () => {
      document.getElementById('privacy-modal').classList.add('active');
    });

    document.getElementById('close-privacy').addEventListener('click', () => {
      document.getElementById('privacy-modal').classList.remove('active');
    });

    document.getElementById('privacy-modal').addEventListener('click', (e) => {
      if (e.target.id === 'privacy-modal') {
        document.getElementById('privacy-modal').classList.remove('active');
      }
    });

    // Budget & Goal buttons (placeholders)
    document.getElementById('add-budget-btn').addEventListener('click', () => {
      showToast('Budget customization coming in next update!', 'success');
    });

    document.getElementById('add-goal-btn').addEventListener('click', () => {
      showToast('Custom goals coming in next update!', 'success');
    });

    document.querySelectorAll('.nav-item[data-page]').forEach(item => {
      item.addEventListener('click', () => {
        navigateTo(item.dataset.page);
        if (window.innerWidth <= 1024) {
          document.getElementById('sidebar').classList.remove('open');
        }
      });
    });

    // Close sidebar when clicking outside on mobile
    document.addEventListener('click', (e) => {
      const sidebar = document.getElementById('sidebar');
      const menuToggle = document.getElementById('menu-toggle');
      
      if (window.innerWidth <= 1024 && 
          sidebar.classList.contains('open') && 
          !sidebar.contains(e.target) && 
          !menuToggle.contains(e.target)) {
        sidebar.classList.remove('open');
      }
    });

    document.querySelectorAll('.filter-chip').forEach(chip => {
      chip.addEventListener('click', () => {
        document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
        chip.classList.add('active');
        currentFilter = chip.dataset.filter;
        renderTransactions();
      });
    });

    document.querySelectorAll('.period-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentPeriod = btn.dataset.period;
        updateDashboard();
      });
    });

    document.getElementById('search-input').addEventListener('input', (e) => {
      searchQuery = e.target.value;
      renderTransactions();
    });

    document.getElementById('base-currency').addEventListener('change', (e) => {
      baseCurrency = e.target.value;
      document.getElementById('settings-currency').value = baseCurrency;
      document.getElementById('transaction-currency').value = baseCurrency;
      updateDashboard();
      renderTransactions();
      updateAnalytics();
      updateBudgets();
      updateGoals();
      updateReports();
    });

    document.getElementById('settings-currency').addEventListener('change', (e) => {
      baseCurrency = e.target.value;
      document.getElementById('base-currency').value = baseCurrency;
      document.getElementById('transaction-currency').value = baseCurrency;
      updateDashboard();
      renderTransactions();
      updateAnalytics();
      updateBudgets();
      updateGoals();
      updateReports();
    });

    document.getElementById('auto-theme-toggle').addEventListener('change', (e) => {
      autoThemeEnabled = e.target.checked;
      if (autoThemeEnabled) {
        checkAutoTheme();
        showToast('Auto theme switching enabled', 'success');
      } else {
        showToast('Auto theme switching disabled', 'success');
      }
    });

    // Check auto theme every minute
    setInterval(() => {
      checkAutoTheme();
    }, 60000);

    // Browser Compatibility - Mock SDK for testing outside Canva
    function createMockDataSdk() {
      let mockData = [];
      let mockHandler = null;

      return {
        async init(handler) {
          mockHandler = handler;
          // Load from localStorage if available
          const stored = localStorage.getItem('finance-pro-data');
          if (stored) {
            try {
              mockData = JSON.parse(stored);
              mockHandler.onDataChanged(mockData);
            } catch (e) {
              console.error('Failed to load stored data:', e);
            }
          } else {
            mockHandler.onDataChanged([]);
          }
          return { isOk: true, isError: false };
        },
        async create(record) {
          const newRecord = { ...record, __backendId: Date.now().toString() + Math.random() };
          mockData.push(newRecord);
          localStorage.setItem('finance-pro-data', JSON.stringify(mockData));
          if (mockHandler) mockHandler.onDataChanged(mockData);
          return { isOk: true, isError: false };
        },
        async update(record) {
          const index = mockData.findIndex(r => r.__backendId === record.__backendId);
          if (index !== -1) {
            mockData[index] = record;
            localStorage.setItem('finance-pro-data', JSON.stringify(mockData));
            if (mockHandler) mockHandler.onDataChanged(mockData);
          }
          return { isOk: true, isError: false };
        },
        async delete(record) {
          mockData = mockData.filter(r => r.__backendId !== record.__backendId);
          localStorage.setItem('finance-pro-data', JSON.stringify(mockData));
          if (mockHandler) mockHandler.onDataChanged(mockData);
          return { isOk: true, isError: false };
        }
      };
    }

    function createMockElementSdk() {
      let mockConfig = { ...defaultConfig };
      let mockElement = null;

      return {
        get config() {
          return mockConfig;
        },
        async init(element) {
          mockElement = element;
          if (element.onConfigChange) {
            await element.onConfigChange(mockConfig);
          }
        },
        async setConfig(partialConfig) {
          mockConfig = { ...mockConfig, ...partialConfig };
          if (mockElement && mockElement.onConfigChange) {
            await mockElement.onConfigChange(mockConfig);
          }
        }
      };
    }

    // Initialize
    (async () => {
      // Check if SDKs are available (Canva environment) or use mock (browser)
      if (!window.dataSdk) {
        console.log('Running in browser mode - using localStorage');
        window.dataSdk = createMockDataSdk();
      }

      if (!window.elementSdk) {
        window.elementSdk = createMockElementSdk();
      }

      const initResult = await window.dataSdk.init(dataHandler);
      if (!initResult.isOk) {
        showToast('Failed to initialize app', 'error');
      }

      if (window.elementSdk) {
        await window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities: () => ({
            recolorables: [],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined
          }),
          mapToEditPanelValues: (config) => new Map([
            ['app_title', config.app_title || defaultConfig.app_title],
            ['dashboard_subtitle', config.dashboard_subtitle || defaultConfig.dashboard_subtitle],
            ['splash_tagline', config.splash_tagline || defaultConfig.splash_tagline]
          ])
        });
      }

      document.getElementById('transaction-date').valueAsDate = new Date();
      
      // Check auto theme on load
      checkAutoTheme();
    })();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a4c152101413843',t:'MTc2NDE4ODM4NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>